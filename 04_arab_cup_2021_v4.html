<!DOCTYPE html>

<html>
  <head>
    <title>FIFA ARAB CUP 2021</title>
    <meta charset="UTF-8" />
    <meta name="description" content="FIFA ARAB CUP 2021" />
    <meta
      name="keywords"
      content="FIFA, Arab Cub 2021, Arab Cub, Football, Soccer, Qatar"
    />
    <meta name="author" content="AJLabs" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

    <!-- Load d3.js -->
    <script type="text/javascript" src="https://d3js.org/d3.v7.min.js"></script>
    <!-- https://observablehq.com/@didoesdigital/9-june-2020-designing-for-small-screens-responsive-data-viz -->
    <!-- <script type="text/javascript" src="d3.js"></script> -->
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Montserrat:ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;0,800;0,900;1,100;1,200;1,300;1,400;1,500;1,600;1,700;1,800;1,900&display=swap"
      rel="stylesheet"
    />
    <style>
      html {
        background-color: #000000;
      }
      * {
        font-family: "Montserrat", sans-serif;
        margin: 0;
        padding: 0;
      }

      h1 {
        font-size: 1em;
        text-align: center;
        color: white;
        opacity: 1;
        margin-bottom: 20px;
        font-weight: 400;
        padding-top: 20px;
        /*border: 0.5px solid grey;*/
      }

      p {
        display: inline-block;
        font-size: 12px;
        color: grey;
      }

      #vizboard {
        display: inline-block;
        position: relative;
        margin: 10px auto;
        text-align: center;
        width: 100%;
        /* padding-bottom: 100%; */
        /* vertical-align: top; */
        /* overflow: hidden; */
      }

      .svg-vizboard {
        display: inline-block;
        position: absolute;
        top: 0;
        left: 0;
      }

      .axis line,
      .axis path {
        stroke: grey;
        opacity: 0.4;
        shape-rendering: crispEdges;
      }

      .axis text {
        fill: grey;
        font-size: 7px;
        opacity: 0.5;
      }
    </style>
  </head>

  <body>
    <h1></h1>
    <div id="vizboard"></div>
    <script type="text/javascript">
      ///////////////////////////////////////////////////////////////////////////////////////////////////////////////////
      ///////////////////////////////////////////////////////////////////////////////////////////////////////////////////
      // 01. Setup //////////////////////////////////////////////////////////////////////////////////////////////////////
      ///////////////////////////////////////////////////////////////////////////////////////////////////////////////////
      ///////////////////////////////////////////////////////////////////////////////////////////////////////////////////
      // Dimensions
      let dimensions = {
        width: window.innerWidth * 0.95,
        height: window.innerHeight * 0.9,
        margin: {
          top: 50,
          right: 130,
          bottom: 50,
          left: 130,
        },
      };

      //Define drawing area within "dimensions" object
      dimensions.vizboardWidth =
        dimensions.width - dimensions.margin.left - dimensions.margin.right;

      dimensions.vizboardHeight =
        dimensions.height - dimensions.margin.top - dimensions.margin.bottom;

      ///////////////////////////////////////////////////////////////////////////////////////////////////////////////////
      // Draw SVG
      const vizboardSide = 1200;

      const vizboard = d3
        .select("#vizboard")
        .append("svg")
        .classed("svg-vizboard", true)
        .attr("viewBox", `0 0 ${vizboardSide} ${vizboardSide}`);
      // .attr("preserveAspectRatio", "xMinYMin meet");
      // .style("border", "1px dashed lightblue")

      let svg = vizboard
        .append("g")
        .style(
          "transform",
          `translate(${dimensions.margin.left}px, ${dimensions.margin.top}px)`
        );

      ///////////////////////////////////////////////////////////////////////////////////////////////////////////////////
      // Create SVG dimensions
      let width =
        vizboardSide - dimensions.margin.left - dimensions.margin.right;
      let height =
        vizboardSide - dimensions.margin.top - dimensions.margin.bottom;

      ///////////////////////////////////////////////////////////////////////////////////////////////////////////////////
      ///////////////////////////////////////////////////////////////////////////////////////////////////////////////////
      // 02. Data ///////////////////////////////////////////////////////////////////////////////////////////////////////
      ///////////////////////////////////////////////////////////////////////////////////////////////////////////////////
      ///////////////////////////////////////////////////////////////////////////////////////////////////////////////////
      let points = [];
      for (var i = 0; i < 24; i++) {
        var x = {
          group: i % 2 == 0 ? 0 : 1, //0-4
          // group: 1,
          value: 10,
        };
        points.push(x);
      }

      // // Test Data
      // console.log("data:", points);

      const arabMatches_file =
        "https://raw.githubusercontent.com/muhhossein/p009_arabcup2021/main/arabMatches.csv";
      const arabMatchesLong_file =
        "https://raw.githubusercontent.com/muhhossein/p009_arabcup2021/main/arabMatchesLong.csv";
      const arabTeams_file =
        "https://raw.githubusercontent.com/muhhossein/p009_arabcup2021/main/arabTeams.csv";

      // dataset
      var arabMatches = [];
      var arabMatchesData = [];
      var arabCountriesData = [];
      var arabTeamsData = [];

      // matches converter function
      var matches_converter = function (point) {
        return {
          home_team: point.home_team_,
          away_team: point.away_team_,
          home_team_text: point.home_team,
          away_team_text: point.away_team,
          tournament: point.tournament,
          home_score: +point.home_score,
          away_score: +point.away_score,
          match_serial: +point.serial,
          year: +point.year,
          decade: +point.decade,
          year_n: +point.year_n,
          home_result_desc: point.home_result_desc,
          away_result_desc: point.away_result_desc,
          size: +point.result,
          home_random: +point.home_random,
          away_random: +point.away_random,
          home_group: +point.home_group,
          away_group: +point.away_group,
        };
      };

      // data converter function
      var data_converter = function (point) {
        return {
          team: point.team_,
          team_text: point.team,
          home_team: point.home_team_,
          away_team: point.away_team_,
          home_team_text: point.home_team,
          away_team_text: point.away_team,
          match_serial: +point.serial,
          year: +point.year,
          decade: +point.decade,
          year_n: +point.year_n,
          result_desc: point.result_desc,
          size: +point.size,
          random: +point.random,
          tournament: point.tournament,
        };
      };

      // teams data converter function
      var teams_converter = function (point) {
        return {
          serial: +point.serial,
          player_serial: +point.player_serial,
          team: point.team_,
          team_name: point.team,
          player: point.player,
          age: +point.age,
          club: point.club,
          height: +point.height,
          matches: +point.international_matches,
          goals: +point.goals,
          market_value: point.market_value,
          value: +point.value,
          position: point.position,
          is_foreigner: +point.is_foreigner,
          team_country: point.team_country,
          squad_size: +point.squad_size,
          total_value: point.total_value,
          team_value: +point.team_value,
          ranking: +point.FIFA_world_ranking,
          confederation: point.confederation,
        };
      };

      ///////////////////////////////////////////////////////////////////////////////////////////////////////////////////
      ///////////////////////////////////////////////////////////////////////////////////////////////////////////////////
      Promise.all([
        d3.csv(arabMatches_file, matches_converter),
        d3.csv(arabMatchesLong_file, data_converter),
        d3.csv(arabTeams_file, teams_converter),
      ]).then(function ([matches, data, teams]) {
        // save data in dataset variable
        arabMatches = matches;
        arabMatchesData = data; //.filter(d => d.country == "China");
        arabTeamsData = teams;

        // console.log(arabTeamsData[0]);
        // call the draw function
        dataviz();
      }); //end of then method

      function dataviz() {
        ///////////////////////////////////////////////////////////////////////////////////////////////////////////////////
        ///////////////////////////////////////////////////////////////////////////////////////////////////////////////////
        // 03. Nested Data ////////////////////////////////////////////////////////////////////////////////////////////////
        ///////////////////////////////////////////////////////////////////////////////////////////////////////////////////
        ///////////////////////////////////////////////////////////////////////////////////////////////////////////////////
        // Teams Data
        arabCountriesData = d3.flatRollup(
          arabTeamsData,
          (v) => v.length,
          (d) => d.team,
          (d) => d.team.value
        );

        arabTeamsData = arabTeamsData
          .slice()
          .sort((a, b) => d3.ascending(a.team, b.team));

        arabCountriesData = arabCountriesData
          .slice()
          .sort((a, b) => d3.ascending(a[0], b[0]));

        arabCountriesData = arabCountriesData.map((d, i) => {
          return {
            team: d[0],
            group: i % 2 == 0 ? 1 : 0,
            value: d[1],
          };
        });

        // console.log(arabCountriesData);

        // Nested Data
        var arabMatchesData_groups = d3.flatGroup(arabTeamsData, (d) => d.team);

        // console.log(arabMatchesData_groups);

        // Nested Data for teams
        var arabTeamsData_groups = d3.flatGroup(arabTeamsData, (d) => d.team);

        // console.log(arabTeamsData[0]);

        ///////////////////////////////////////////////////////////////////////////////////////////////////////////////////
        ///////////////////////////////////////////////////////////////////////////////////////////////////////////////////
        // 04. Scales /////////////////////////////////////////////////////////////////////////////////////////////////////
        ///////////////////////////////////////////////////////////////////////////////////////////////////////////////////
        ///////////////////////////////////////////////////////////////////////////////////////////////////////////////////
        // Radial Scale
        const radial_domain = [0, 100];
        const inner_r = 60;
        const outer_r = d3.min([width, height]) * 0.5;
        const radial_scale = d3
          .scaleLinear()
          .domain(radial_domain)
          .range([inner_r, outer_r]);

        // Angle Scale
        const angluar_domain = [0, 24]; // 0-23ØŒ we have a domain reserved for 23 element.
        const angluar_scale = d3
          .scaleLinear()
          .domain(angluar_domain)
          .range([0, 2 * Math.PI]);

        // Angle Slice
        const angleSlice = (Math.PI * 2) / (arabCountriesData.length + 1);

        // A scale that gives a X target position for each group
        const group_scale = d3.scalePoint().domain([0, 1]).range([70, 100]);

        // Sub Circles Scale
        const subGroups_scale = d3.scaleLinear().domain([1, 8]).range([10, 80]);

        // Team Group Scale
        const teams_domain = arabCountriesData.map((d, i) => d.team);
        const teams_range = [
          1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1,
        ];

        console.log(teams_domain);

        const teams_group_serial = d3
          .scaleOrdinal()
          .domain(teams_domain)
          .range(d3.range(1, 24, 1));

        const teams_group_scale = d3
          .scaleOrdinal()
          .domain(teams_domain)
          .range(teams_range);

        // circles radius scale
        const r_scale = d3.scaleLinear().domain([0, 100]).range([1, 50]);

        // Color Scale
        // https://github.com/d3/d3-scale-chromatic
        // const color_scale = d3
        //   .scaleSequential()
        //   .domain(d3.extent(points, (d) => d.value))
        //   .interpolator(d3.interpolateCividis);

        // Match Radial Scale
        var match_radial_scale = d3
          .scaleOrdinal()
          .domain([1, 2, 3, 4, 5, 6, 7, 8])
          .range([10, 20, 30, 40, 50, 60, 70, 80]);

        // Angle Match Slice
        const angleMatchSlice = (Math.PI * 2) / 10;

        // Match Color Scale
        const match_color_scale = d3
          .scaleOrdinal()
          .domain(["winner", "loser", "draw"])
          .range(["#00eaff", "#ff0062", "#f6ff00"]);

        // Match Color Scale
        const cline_color_scale = d3
          .scaleOrdinal()
          .domain(["winner", "loser", "draw"])
          .range(["#00a6c7", "#c7003f", "yellow"]);

        // Match Result Scale
        const match_result_scale = d3
          .scaleSqrt()
          .domain([0, 14])
          .range([1.5, 8]);

        // Match Result Scale
        const match_line_scale = d3
          .scaleLinear()
          .domain([0, 14])
          .range([1, 2.5]);

        // Opacity Scale
        const result_opacity_scale = d3
          .scaleLinear()
          .domain([0, 14])
          .range([0.1, 0.5]);

        // Player tradeVlaue scale
        const player_value_scale = d3
          .scaleSqrt()
          .domain([0, 10000, 100000000])
          .range([2, 4, 15]);

        const player_line_scale = d3
          .scaleSqrt()
          .domain([0, 10000, 100000000])
          .range([1, 1.7, 4]);

        const player_color_scale = d3
          .scaleLinear()
          .domain(d3.extent(arabTeamsData, (d) => d.value))
          .range(["#00a6c7", "lightblue"]);

        const player_color_scale2 = d3
          .scaleSequential()
          .domain(d3.extent(arabTeamsData, (d) => d.value))
          .interpolator(d3.interpolateRainbow);

        const player_color_scale3 = d3
          .scaleSequential()
          .domain([0, 1])
          .range(["#00eaff", "#ff0062"]);

        // Player tradeVlaue scale
        const player_age_scale = d3
          .scaleLinear()
          .domain([0, 20, 30])
          .range([30, 45, 66]);

        // Player tradeVlaue scale
        const player_serial_scale = d3
          .scaleLinear()
          .domain(d3.extent(arabTeamsData, (d) => d.player_serial))
          .range([0, 2 * Math.PI]);

        // teams arab cup scale
        const acup_domain = arabCountriesData.map((d, i) => d.team);
        const acup_range = [
          1, 1, 0, 0, 1, 1, 1, 0, 1, 0, 1, 1, 1, 1, 1, 1, 0, 0, 1, 1, 1, 1, 0,
        ];
        const acup_scale = d3
          .scaleOrdinal()
          .domain(acup_domain)
          .range(acup_range);

        ///////////////////////////////////////////////////////////////////////////////////////////////////////////////////
        ///////////////////////////////////////////////////////////////////////////////////////////////////////////////////
        // 05. Shapes Creation ////////////////////////////////////////////////////////////////////////////////////////////
        ///////////////////////////////////////////////////////////////////////////////////////////////////////////////////
        ///////////////////////////////////////////////////////////////////////////////////////////////////////////////////
        // Create Group
        const mainGroup = svg
          .append("g")
          .classed("main-group", true)
          .attr("transform", `translate(${width * 0.5}, ${height * 0.5})`);

        // Positions
        const p_position = function (d, i) {
          let x =
            radial_scale(group_scale(d.group)) *
            Math.cos(angleSlice * (i + 1) - Math.PI / 2);

          let y =
            radial_scale(group_scale(d.group)) *
            Math.sin(angleSlice * (i + 1) - Math.PI / 2);

          return [x, y];
        };

        const subGroups = mainGroup
          .selectAll("g.sub-groups")
          .data(arabCountriesData)
          .enter()
          .append("g")
          .classed("sub-groups", true)
          .attr("id", (d) => d.team)
          .attr("transform", (d, i) => `translate(${p_position(d, i)})`);

        // Reference Circles
        const refCircles = subGroups.each(function (d, i) {
          d3.select(this)
            .selectAll("circle.ref-circles")
            .data([20, 25, 30, 35])
            .enter()
            .append("circle")
            .classed("ref-circles", true)
            .attr("cx", 0)
            .attr("cy", 0)
            .attr("r", (d, i) => player_age_scale(d))
            .style("fill-opacity", 1)
            .style("stroke", "blue")
            .style("stroke-dasharray", "5,2")
            .style("stroke-width", 1)
            .style("stroke-opacity", 0.5)
            .lower();
        });

        // const overCircles = subGroups.each(function (d, i) {
        //   d3.select(this)
        //     .append("circle")
        //     .attr("cx", 0)
        //     .attr("cy", 0)
        //     .attr("r", (d, i) => subGroups_scale(9))
        //     .style("fill", "black")
        //     .style("opacity", 0);
        // });
        ///////////////////////////////////////////////////////////////////////////////////////////////////////////////////
        ///////////////////////////////////////////////////////////////////////////////////////////////////////////////////
        // 10. Text ////////////////////////////////////////////////////////////////////////////////////////////
        ///////////////////////////////////////////////////////////////////////////////////////////////////////////////////
        ///////////////////////////////////////////////////////////////////////////////////////////////////////////////////
        // Position Functions
        const text_position = function (d, i) {
          let x =
            (radial_scale(group_scale(teams_group_scale(d[0]))) + 115) *
            Math.cos(angleSlice * teams_group_serial(d[0]) - Math.PI / 2);

          let y =
            (radial_scale(group_scale(teams_group_scale(d[0]))) + 115) *
            Math.sin(angleSlice * teams_group_serial(d[0]) - Math.PI / 2);

          return [x, y];
        };

        // Text Groups
        let textGroups = mainGroup
          .selectAll("g.text-groups")
          .data(arabMatchesData_groups)
          .enter()
          .append("g")
          .classed("text-groups", true)
          .attr("id", (d) => `${d[0]}_team_txt`)
          .attr("transform", (d, i) => `translate(${text_position(d, i)})`)
          .each(function (d, i) {
            d3.select(this)
              .append("circle")
              .attr("cx", 0)
              .attr("cy", 0)
              .attr("r", 15)
              .attr("class", "blue-circle-s")
              .style("fill", (d, i) =>
                acup_scale(d[0]) == 1 ? "blue" : "#ad0043"
              )
              .style("opacity", 0.3);

            d3.select(this)
              .append("circle")
              .attr("cx", 0)
              .attr("cy", 0)
              .attr("r", 30)
              .attr("class", "blue-circle-l")
              .style("fill", (d, i) =>
                acup_scale(d[0]) == 1 ? "blue" : "#ad0043"
              )
              .style("opacity", 0.3);

            d3.select(this)
              .append("text")
              .attr("x", 0)
              .attr("y", 0)
              .attr("id", (d) => `label_${d[0]}`)
              .text((d, i) => d[0])
              .style("fill", "white")
              .style("font-size", "12px")
              .style("text-anchor", "middle")
              .style("alignment-baseline", "middle");

            d3.select(this)
              .append("circle")
              .attr("cx", 0)
              .attr("cy", 0)
              .attr("r", 40)
              .attr("class", "hover-circle")
              .style("fill", "blue")
              .style("opacity", 0);
          });

        // change labels
        d3.select("#label_South_Sudan")
          .text("South Sudan")
          .attr("transform", "translate(-20,0)");
        d3.select("#label_Saudi_Arabia")
          .text("Saudi Arabia")
          .attr("transform", "translate(-10,0)");
        ///////////////////////////////////////////////////////////////////////////////////////////////////////////////////
        ///////////////////////////////////////////////////////////////////////////////////////////////////////////////////
        // 06. Matches Circles ////////////////////////////////////////////////////////////////////////////////////////////
        ///////////////////////////////////////////////////////////////////////////////////////////////////////////////////
        ///////////////////////////////////////////////////////////////////////////////////////////////////////////////////
        // Position Functions
        const team_position = function (d, i) {
          let x =
            radial_scale(group_scale(teams_group_scale(d[0]))) *
            Math.cos(angleSlice * teams_group_serial(d[0]) - Math.PI / 2);

          let y =
            radial_scale(group_scale(teams_group_scale(d[0]))) *
            Math.sin(angleSlice * teams_group_serial(d[0]) - Math.PI / 2);

          return [x, y];
        };

        // Matched Circles
        let teamGroups = mainGroup
          .selectAll("g.team-groups")
          .data(arabTeamsData_groups)
          .enter()
          .append("g")
          .classed("team-groups", true)
          .attr("id", (d) => `${d[0]}_team`)
          .attr("transform", (d, i) => `translate(${team_position(d, i)})`);

        // teamGroups.lower();
        // console.log(player_value_scale(200000000));
        ///////////////////////////////////////////////////////////////////////////
        // Angle Match Slice
        const anglePlayerSlice = function (d, i) {
          let angle = (Math.PI * 2) / d;
          return angle;
        };

        // Position Functions
        const player_Xposition = function (d) {
          let x =
            player_age_scale(d.age) *
            Math.cos(
              anglePlayerSlice(d.squad_size) * d.player_serial - Math.PI / 2
            );
          return x;
        };

        const player_Yposition = function (d) {
          let y =
            player_age_scale(d.age) *
            Math.sin(
              anglePlayerSlice(d.squad_size) * d.player_serial - Math.PI / 2
            );
          return y;
        };

        // Core Circles
        let teamCircles = teamGroups.each(function (d, i) {
          let team_value = arabTeamsData_groups[i][1][0].team_value;
          let squad_size = d3.select(this).data()[0][1][0].squad_size;
          d3.select(this)
            .append("circle")
            .attr("class", "team-circles")
            .attr("cx", 0)
            .attr("cy", 0)
            .attr(
              "r",
              (d, i) => player_value_scale(team_value) + squad_size * 0.8
            )
            .style("fill", "#384075")
            .style("opacity", 1);
        });

        // Player Lines
        let playerLines = teamGroups.each(function (d, i) {
          d3.select(this)
            .selectAll("line.player-liness")
            .data((d, i) => d[1]) // to access value
            .enter()
            .append("line")
            .attr("class", (d) => `player-lines player_${d.serial}`)
            .attr("x1", 0)
            .attr("y1", 0)
            .attr("x2", (d, i) => player_Xposition(d, i))
            .attr("y2", (d, i) => player_Yposition(d, i))
            .style("stroke-width", (d) => player_line_scale(d.value))
            .style("stroke", (d, i) => player_color_scale3(d.is_foreigner))
            .style("stroke-opacity", 0.8)
            .style("stroke-linecap", "round");
        });

        // Player Circles
        let playerCircles = teamGroups.each(function (d, i) {
          d3.select(this)
            .selectAll("circle.player-circles")
            .data((d, i) => d[1])
            .enter()
            .append("circle")
            .attr("class", (d) => `player-circles player_${d.serial}`)
            .attr("cx", (d, i) => player_Xposition(d, i))
            .attr("cy", (d, i) => player_Yposition(d, i))
            .attr("r", (d, i) => player_value_scale(d.value))
            .style("fill", (d, i) => player_color_scale3(d.is_foreigner))
            .style("stroke-width", 0.5)
            .style("stroke", (d, i) => player_color_scale3(d.is_foreigner))
            .style("fill-opacity", 0.7)
            .style("stroke-opacity", 1);
        });

        // Player Highlight
        let playerHighlight = function () {
          teamGroups.each(function (d, i) {
            d3.select(this)
              .selectAll("circle.highlight-circles")
              .data((d, i) => d[1])
              .enter()
              .append("circle")
              .attr("class", (d) => `highlight-circles player_h_${d.serial}`)
              .attr("cx", (d, i) => player_Xposition(d, i))
              .attr("cy", (d, i) => player_Yposition(d, i))
              .attr("r", (d, i) =>
                d.value > 0 ? player_value_scale(d.value) + 7 : 10
              )
              .style("fill", "black")
              .style("fill-opacity", 0)
              .style("stroke-width", 2)
              .style("stroke", "white")
              .style("opacity", 0);
            // .style("stroke-dasharray", "2 2");

            // console.log(d3.select(this).data()[0][1][i]);
          });
        };
        playerHighlight();

        ///////////////////////////////////////////////////////////////////////////////////////////////////////////////////
        ///////////////////////////////////////////////////////////////////////////////////////////////////////////////////
        // 07. Centeral Circles ///////////////////////////////////////////////////////////////////////////////////////////
        ///////////////////////////////////////////////////////////////////////////////////////////////////////////////////
        ///////////////////////////////////////////////////////////////////////////////////////////////////////////////////
        // Data
        const centeral_circles = [45];

        // Add circles as gridlines
        mainGroup
          .selectAll("circle.centeral-circles")
          .data(centeral_circles)
          .enter()
          .append("circle")
          .classed("centeral-circles", true)
          .attr("cx", 0)
          .attr("cy", 0)
          .attr("r", (d) => radial_scale(d))
          .attr("fill", "none")
          .attr("stroke", "grey")
          .attr("stroke-width", 2)
          .attr("opacity", 0);

        ///////////////////////////////////////////////////////////////////////////////////////////////////////////////////
        ///////////////////////////////////////////////////////////////////////////////////////////////////////////////////
        // 08. Connection lines Functions /////////////////////////////////////////////////////////////////////////////////
        ///////////////////////////////////////////////////////////////////////////////////////////////////////////////////
        ///////////////////////////////////////////////////////////////////////////////////////////////////////////////////
        // "#00eaff", "#ff0062"
        const team_text = mainGroup
          .append("g")
          .attr("id", "id-g-text")
          .style("transform", "translate(0px,0px)")
          .style("font-size", "18px")
          .style("text-align", "center")
          .style("text-anchor", "middle")
          .style("fill", "#ff0062")
          .style("opacity", 1)
          .each(function (d, i) {
            // team ranking
            d3.select(this)
              .append("text")
              .attr("id", "id-team")
              .attr("y", -170)
              .style("font-size", "24px")
              .text("Arab Football");

            // team ranking
            d3.select(this)
              .append("text")
              .attr("id", "id-team-ranking")
              .attr("y", -140)
              .style("font-size", "22px")
              .text("Teams and players");

            // team confederation
            d3.select(this)
              .append("text")
              .attr("id", "id-confederation-value")
              .attr("y", -115)
              .style("font-size", "14px")
              .text("");

            // breakline
            d3.select(this)
              .append("text")
              .attr("y", -90)
              .style("fill", "blue")
              .text("__________");

            // player name
            d3.select(this)
              .append("text")
              .attr("id", "id-player-name")
              .attr("y", -40)
              .style("font-size", "24px")
              .style("fill", "#00eaff")
              .text("");

            // player club
            d3.select(this)
              .append("text")
              .attr("id", "id-player-club")
              .attr("y", -10)
              .style("font-size", "18px")
              .style("fill", "#00eaff")
              .text("");

            // player position
            d3.select(this)
              .append("text")
              .attr("id", "id-player-position")
              .attr("y", 30)
              .style("font-size", "16px")
              .style("fill", "white")
              .text("");

            // player value
            d3.select(this)
              .append("text")
              .attr("id", "id-player-value")
              .attr("y", 60)
              .style("font-size", "16px")
              .style("fill", "white")
              .text("");

            // player matches
            d3.select(this)
              .append("text")
              .attr("id", "id-player-matches")
              .attr("y", 90)
              .style("font-size", "16px")
              .style("fill", "white")
              .text("");

            // player age
            d3.select(this)
              .append("text")
              .attr("id", "id-player-age")
              .attr("y", 120)
              .style("font-size", "16px")
              .style("fill", "white")
              .text("");
            // name, age, club, height, position, international_matches, goals, market value,
            // country, total value, ranking, confederation
          });

        ///////////////////////////////////////////////////////////////////////////////////////////////////////////////////
        ///////////////////////////////////////////////////////////////////////////////////////////////////////////////////
        // 11. How to read ////////////////////////////////////////////////////////////////////////////////////////////////
        ///////////////////////////////////////////////////////////////////////////////////////////////////////////////////
        ///////////////////////////////////////////////////////////////////////////////////////////////////////////////////
        const read_box = mainGroup
          .append("g")
          .style("transform", "translate(0px, 200px)")
          .style("font-size", "18px")
          .style("text-align", "center")
          .style("text-anchor", "middle")
          .style("fill", "grey")
          .style("opacity", 1)
          .each(function (d, i) {
            // text
            d3.select(this)
              .append("text")
              .style("font-size", "18px")
              .text("How to read it?");

            d3.select(this)
              .append("rect")
              .attr("id", "how-to-read")
              .attr("x", -75)
              .attr("y", -20)
              .attr("height", 30)
              .attr("width", 150)
              .attr("rx", 10)
              .style("opacity", 0);

            d3.select(this)
              .append("rect")
              .attr("class", "how-to-read-img")
              .attr("x", -310)
              .attr("y", -410)
              .attr("height", 370)
              .attr("width", 620)
              .attr("rx", 20)
              .style("fill", "black")
              .style("stroke", "blue")
              .style("visibility", "hidden");

            d3.select(this)
              .append("image")
              .attr("class", "how-to-read-img")
              .attr("x", -300)
              .attr("y", -405)
              .attr("height", 360)
              .attr("width", 600)
              .attr("href", "how_to_read_players.jpg")
              .style("visibility", "hidden");
          });
        d3.select("#how-to-read")
          .on("mousemove", function () {
            d3.selectAll(".how-to-read-img").style("visibility", "visible");
          })
          .on("mouseleave", function () {
            d3.selectAll(".how-to-read-img").style("visibility", "hidden");
          });

        ///////////////////////////////////////////////////////////////////////////////////////////////////////////////////
        ///////////////////////////////////////////////////////////////////////////////////////////////////////////////////
        // 12. Events /////////////////////////////////////////////////////////////////////////////////////////////////////
        ///////////////////////////////////////////////////////////////////////////////////////////////////////////////////
        ///////////////////////////////////////////////////////////////////////////////////////////////////////////////////

        function mouseover() {
          let player_serial = d3.select(this).data()[0].serial;
          let player_data = d3.select(this).data()[0];

          team_text.style("opacity", 1);

          d3.select(`circle.player_${player_serial}`)
            .transition()
            .duration(50)
            .style("fill-opacity", 1)
            .attr("r", (d, i) => player_value_scale(d.value) + 1.5);

          d3.select(`line.player_${player_serial}`)
            .transition()
            .duration(50)
            .style("stroke-opacity", 1)
            .style("stroke-width", (d) => player_line_scale(d.value) + 0.7);

          d3.select(`circle.player_h_${player_serial}`)
            .transition()
            .duration(0)
            .style("opacity", 1);

          // text
          d3.select("#id-team")
            .style("font-size", "22px")
            .text(`${player_data.team_name}`);

          d3.select("#id-team-ranking")
            .style("font-size", "14px")
            .text(
              `${player_data.confederation} | ${player_data.squad_size} players`
            );
          d3.select("#id-confederation-value").text(
            `World ranking: ${player_data.ranking} | Trade value: ${player_data.total_value}`
          );
          d3.select("#id-player-name").text(`${player_data.player}`);
          d3.select("#id-player-club").text(
            `${player_data.club} | ${
              player_data.team_country == "-"
                ? player_data.team_name
                : player_data.team_country
            }`
          );
          d3.select("#id-player-position").text(`${player_data.position}`);
          d3.select("#id-player-value").text(
            `Trade value: ${
              player_data.market_value == "-" ? "-" : player_data.market_value
            }`
          );
          d3.select("#id-player-matches").text(
            `International matches: ${player_data.matches}`
          );
          d3.select("#id-player-age").text(
            `Age: ${player_data.age == 0 ? "-" : player_data.age}`
          );

          // moving circle
          playerHighlight();
          d3.selectAll(".highlight-circles").style("opacity", 0);

          // moving_circle
          //   .attr("cx", d3.select(this).node().getBoundingClientRect().x)
          //   .attr("cy", d3.select(this).node().getBoundingClientRect().y)
          //   .attr("r", 20);
        }

        function mouseleave() {
          d3.selectAll("circle.player-circles")
            .transition()
            .duration(50)
            .style("fill-opacity", 0.7)
            .attr("r", (d, i) => player_value_scale(d.value));

          d3.selectAll("line.player-lines")
            .transition()
            .duration(50)
            .style("stroke-opacity", 0.8)
            .style("stroke-width", (d) => player_line_scale(d.value));
        }

        d3.selectAll("circle.highlight-circles")
          .on("mouseover", mouseover)
          .on("mouseleave", mouseleave);

        ///////////////////////////////////////////////////////
        ///////////////////////////////////////////////////////
        ///////////////////////////////////////////////////////
        ///////////////////////////////////////////////////////
        // // mouse over
        // function team_mouseover() {
        //   let selected_team = d3.select(this).data()[0][0];
        //   console.log(selected_team);

        //   // text groups
        //   textGroups.style("opacity", 0.65);
        //   d3.select(`#${selected_team}_team_txt`).style("opacity", 1);
        //   d3.select(`#${selected_team}_team_txt .blue-circle-s`).attr("r", 18);
        //   d3.select(`#${selected_team}_team_txt .blue-circle-l`).attr("r", 33);

        //   team_text.style("opacity", 1);
        // }

        // // mouse leave
        // function team_mouseleave() {
        //   // text groups
        //   textGroups.style("opacity", 1);
        //   // d3.selectAll(`.blue-circle-s`).attr("r", 15);
        //   // d3.selectAll(`.blue-circle-l`).attr("r", 30);
        // }

        // // overCircles.on("mouseenter", mouseover).on("mouseleave", mouseleave);
        // d3.selectAll(".hover-circle")
        //   .on("mouseover", team_mouseover)
        //   .on("mousedown", team_mouseover)
        //   .on("mouseleave", function () {
        //     team_text.style("opacity", 0);
        //   });
        // // .on("mouseleave", mouseleave);

        // vizboard.on("mousedown", mouseleave);
      } // end of the dataviz
    </script>
  </body>
</html>
